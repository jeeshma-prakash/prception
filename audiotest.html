<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multi-tab Multilingual Audio Box</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Wavesurfer.js CDN -->
  <script src="https://unpkg.com/wavesurfer.js"></script>

  <style>
    /* Theme root variable ‚Äî change this once to change color everywhere */
    :root {
      --primary-color: #5b21b6; /* deep violet (change as you like) */
      --primary-contrast: #ffffff;
      --muted: #6b7280;
    }

    /* Tab active */
    .tab-active {
      color: var(--primary-color);
      border-bottom: 3px solid var(--primary-color);
      font-weight: 600;
    }

    /* custom player controls */
    .play-btn {
      background: var(--primary-color);
      color: var(--primary-contrast);
    }

    /* small shadow for card */
    .card-shadow {
      box-shadow: 0 10px 30px rgba(20, 20, 30, 0.06);
    }

    /* Ensure dropup menu sits above content and doesn't overlap transcript */
    .dropup-menu {
      min-width: 160px;
    }

    /* Wavesurfer container rounding */
    .wave-container {
      border-radius: 10px;
      overflow: hidden;
    }

    /* responsive max width fix */
    @media (min-width: 768px) {
      .content-max {
        max-width: 900px;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-inter antialiased text-gray-800">

  <!-- Page nav (tabs) -->
  <nav class="bg-white border-b sticky top-0 z-20">
    <div class="max-w-6xl mx-auto px-6">
      <div class="flex items-center h-16">
        <div class="flex space-x-8">
          <button class="tab-btn tab-active px-1 pb-3" data-tab="education">Education Call</button>
          <button class="tab-btn px-1 pb-3" data-tab="realestate">Real Estate Call</button>
          <button class="tab-btn px-1 pb-3" data-tab="sales">Sales Call</button>
          <button class="tab-btn px-1 pb-3" data-tab="other">Other</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <main class="py-10">
    <div class="mx-auto px-6 content-max max-w-3xl">
      <section id="box" class="relative bg-white rounded-2xl p-8 card-shadow">
        <!-- dynamic content will be injected here -->
        <div id="dynamic-area"></div>

        <!-- language dropup bottom-left -->
        <div class="absolute left-6 bottom-6">
          <div class="relative">
            <button id="lang-toggle" class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-100 border text-sm shadow-sm">
              <span id="lang-emoji">üåê</span>
              <span id="lang-label">English</span>
              <svg class="w-4 h-4 opacity-60" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 8L10 12L14 8" stroke="#374151" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>

            <div id="lang-menu" class="hidden absolute -bottom-2 left-0 transform translate-y-full mt-2 bg-white border rounded-lg drop-shadow-sm z-30 dropup-menu">
              <button class="block w-full text-left px-4 py-2 hover:bg-gray-50 lang-option" data-lang="english">English</button>
              <button class="block w-full text-left px-4 py-2 hover:bg-gray-50 lang-option" data-lang="malayalam">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
            </div>
          </div>
        </div>

      </section>
    </div>
  </main>

  <!-- Template & Script -->
  <script>
    /*********************************************************
     * Data model: sample audio URLs and transcripts organized
     * by tab and language. Replace the audio URLs & transcripts
     * with your real content.
     *********************************************************/
    const data = {
      education: {
        english: {
          title: "Text to Speech ‚Äî Education Call",
          desc: "This is an education call sample. Play the audio and then press 'Analyze' to show transcript.",
          audio: "https://www.kozco.com/tech/piano2-CoolEdit.mp3",
          transcript: "English Education Call ‚Äî This is a sample transcript for the education call audio. (English sample.)",
          analyzeLabel: "Analyze"
        },
        malayalam: {
          title: "‡¥ü‡µÜ‡¥ï‡µç‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥ü‡µÅ ‡¥∏‡µç‡¥™‡µÄ‡¥ö‡µç‡¥ö‡µç ‚Äî ‡¥é‡¥°‡µç‡¥Ø‡µÇ‡¥ï‡µá‡¥∑‡µª ‡¥ï‡µã‡µæ",
          desc: "‡¥á‡¥§‡µç ‡¥é‡¥°‡µç‡¥Ø‡µÇ‡¥ï‡µá‡¥∑‡µª ‡¥ï‡µã‡µæ ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ ‡¥Ü‡¥£‡µç. ‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥™‡µç‡¥≤‡µá ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç '‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç' ‡¥Ö‡¥Æ‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‚Äå‡¥ï‡µç‡¥∞‡¥ø‡¥™‡µç‡¥±‡µç‡¥±‡µç ‡¥ï‡¥æ‡¥£‡¥æ‡µª.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
          transcript: "‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‡¥é‡¥°‡µç‡¥Ø‡µÇ‡¥ï‡µá‡¥∑‡µª ‡¥ï‡µã‡µæ ‚Äî ‡¥á‡¥§‡µç ‡¥ì‡¥°‡¥ø‡¥Ø‡µã‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µç –∞—Ä–Ω–∞–ª“ì–∞–Ω ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‚Äå‡¥ï‡µç‡¥∞‡¥ø‡¥™‡µç‡¥±‡µç‡¥±‡¥æ‡¥£‡µç.",
          analyzeLabel: "‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç"
        }
      },

      realestate: {
        english: {
          title: "Real Estate Call",
          desc: "Sample real-estate style call. Press Analyze to get the transcript.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
          transcript: "English Real Estate Call ‚Äî This is a sample transcript for the real estate call.",
          analyzeLabel: "Analyze"
        },
        malayalam: {
          title: "‡¥±‡¥ø‡¥Ø‡µΩ ‡¥é‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥±‡µç‡¥±‡µç ‡¥ï‡µã‡µæ",
          desc: "‡¥±‡¥ø‡¥Ø‡µΩ ‡¥é‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥±‡µç‡¥±‡µç ‡¥ï‡µã‡µæ ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ. ‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥™‡µç‡¥≤‡µá ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç '‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç' ‡¥Ö‡¥Æ‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
          transcript: "‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‡¥±‡¥ø‡¥Ø‡µΩ ‡¥é‡¥∏‡µç‡¥±‡µç‡¥±‡µá‡¥±‡µç‡¥±‡µç ‡¥ï‡µã‡µæ ‚Äî ‡¥á‡¥§‡µç ‡¥í‡¥∞‡µÅ ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‚Äå‡¥ï‡µç‡¥∞‡¥ø‡¥™‡µç‡¥±‡µç‡¥±‡µç ‡¥Ü‡¥£‡µç.",
          analyzeLabel: "‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç"
        }
      },

      sales: {
        english: {
          title: "Sales Call",
          desc: "Sales demo audio. Analyze to show the transcript.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3",
          transcript: "English Sales Call ‚Äî Sample transcript text for the sales call audio.",
          analyzeLabel: "Analyze"
        },
        malayalam: {
          title: "‡¥∏‡µÜ‡¥Ø‡¥ø‡µΩ‡¥∏‡µç ‡¥ï‡µã‡µæ",
          desc: "‡¥∏‡µÜ‡¥Ø‡¥ø‡µΩ‡¥∏‡µç ‡¥ï‡µã‡µæ ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ. ‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥ï‡µá‡µæ‡¥ï‡µç‡¥ï‡µÅ‡¥ï‡¥Ø‡µã, ‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï‡¥Ø‡µã ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥ï.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
          transcript: "‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‡¥∏‡µÜ‡¥Ø‡¥ø‡µΩ‡¥∏‡µç ‡¥ï‡µã‡µæ ‚Äî ‡¥á‡¥§‡µç ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‚Äå‡¥ï‡µç‡¥∞‡¥ø‡¥™‡µç‡¥±‡µç‡¥±‡µç ‡¥Ü‡¥£‡µç.",
          analyzeLabel: "‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç"
        }
      },

      other: {
        english: {
          title: "Other",
          desc: "Miscellaneous audio sample. Press Analyze for transcript.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
          transcript: "English Other ‚Äî Sample transcript for miscellaneous audio.",
          analyzeLabel: "Analyze"
        },
        malayalam: {
          title: "‡¥Æ‡¥±‡µç‡¥±‡µÅ",
          desc: "‡¥Æ‡¥±‡µç‡¥±‡µç ‡¥§‡¥∞‡¥§‡µç‡¥§‡¥ø‡¥≤‡µÅ‡¥≥‡µç‡¥≥ ‡¥ì‡¥°‡¥ø‡¥Ø‡µã ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ. '‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç' ‡¥Ö‡¥Æ‡µº‡¥§‡µç‡¥§‡µÅ‡¥ï.",
          audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
          transcript: "‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‚Äî ‡¥á‡¥§‡µç ‡¥Æ‡¥±‡µç‡¥±‡µä‡¥∞‡µÅ ‡¥∏‡¥æ‡¥Æ‡µç‡¥™‡¥ø‡µæ ‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‚Äå‡¥ï‡µç‡¥∞‡¥ø‡¥™‡µç‡¥±‡µç‡¥±‡µç ‡¥Ü‡¥£‡µç.",
          analyzeLabel: "‡¥µ‡¥ø‡¥∂‡¥ï‡¥≤‡¥®‡¥Ç"
        }
      }
    };

    /*********************************************************
     * State
     *********************************************************/
    let currentTab = 'education';
    let currentLang = 'english';
    let wavesurfer = null; // wavesurfer instance
    let isAnalyzing = false;

    /*********************************************************
     * Helper: render the dynamic area (box content)
     *********************************************************/
    function renderBox() {
      const item = data[currentTab][currentLang];
      const container = document.getElementById('dynamic-area');

      container.innerHTML = `
        <header class="mb-4">
          <h1 class="text-2xl font-extrabold tracking-tight text-gray-900">${escapeHtml(item.title)}</h1>
          <p class="text-sm text-gray-600 mt-2">${escapeHtml(item.desc)}</p>
        </header>

        <!-- player area -->
        <div class="mb-6 space-y-4">
          <div class="flex items-center gap-4">
            <button id="play-btn" aria-label="Play/Pause" class="play-btn inline-flex items-center justify-center w-12 h-12 rounded-lg text-white shadow">
              <!-- Play icon (swaps to pause on play) -->
              <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 3v18l15-9L5 3z" />
              </svg>
              <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" style="display:none" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10 6h2v12h-2zM14 6h2v12h-2z"/>
              </svg>
            </button>

            <div class="flex-1">
              <div id="waveform" class="wave-container bg-gray-50 h-16"></div>
            </div>

            <div class="ml-4 text-sm text-gray-600">
              <div id="time-display">00:00 / 00:00</div>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <button id="analyze-btn" class="px-4 py-2 rounded-lg bg-white border shadow-sm text-sm font-medium">${escapeHtml(item.analyzeLabel)}</button>
            <div id="analyze-loader" class="hidden"><div class="w-9 h-9 border-4 border-dashed rounded-full animate-spin" style="border-color: var(--primary-color) transparent transparent transparent;"></div></div>
          </div>
        </div>

        <!-- transcript area -->
        <div id="transcript-wrapper" class="pt-4 border-t">
          <div id="transcript" class="text-gray-700 mt-4 leading-relaxed hidden"></div>
        </div>

        <!-- spacing bottom so dropup won't overlap -->
        <div style="height: 56px;"></div>
      `;

      // Initialize Wavesurfer for the new audio
      initWavesurfer(item.audio);
      setupControls();
    }

    /*********************************************************
     * Escape HTML to avoid injection when using dynamic strings
     *********************************************************/
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    /*********************************************************
     * Initialize / destroy wavesurfer
     *********************************************************/
    function initWavesurfer(audioUrl) {
      // destroy old instance if exists
      if (wavesurfer) {
        wavesurfer.destroy();
        wavesurfer = null;
      }

      // create new instance
      wavesurfer = WaveSurfer.create({
        container: '#waveform',
        waveColor: 'rgba(91,33,182,0.18)',           // light shade of primary
        progressColor: 'var(--primary-color)',      // main color
        cursorColor: 'var(--primary-color)',
        barWidth: 2,
        responsive: true,
        height: 64,
        normalize: true,
        hideScrollbar: true
      });

      // load audio
      wavesurfer.load(audioUrl);

      // update time display as audio plays
      const timeDisplay = document.getElementById('time-display');
      wavesurfer.on('audioprocess', () => {
        const cur = wavesurfer.getCurrentTime();
        const tot = wavesurfer.getDuration() || 0;
        timeDisplay.textContent = formatTime(cur) + ' / ' + formatTime(tot);
      });

      wavesurfer.on('ready', () => {
        const tot = wavesurfer.getDuration() || 0;
        timeDisplay.textContent = '00:00 / ' + formatTime(tot);
      });

      wavesurfer.on('finish', () => {
        togglePlayIcon(false);
      });
    }

    function formatTime(s) {
      if (!s || isNaN(s)) return '00:00';
      const m = Math.floor(s / 60);
      const sec = Math.floor(s % 60);
      return String(m).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
    }

    /*********************************************************
     * Play/Pause & Analyze button setup
     *********************************************************/
    function setupControls() {
      const playBtn = document.getElementById('play-btn');
      const playIcon = document.getElementById('play-icon');
      const pauseIcon = document.getElementById('pause-icon');
      const analyzeBtn = document.getElementById('analyze-btn');
      const analyzeLoader = document.getElementById('analyze-loader');
      const transcriptDiv = document.getElementById('transcript');

      // reset transcript visibility
      transcriptDiv.classList.add('hidden');
      transcriptDiv.textContent = '';

      if (playBtn) {
        playBtn.onclick = () => {
          if (!wavesurfer) return;
          if (wavesurfer.isPlaying()) {
            wavesurfer.pause();
            togglePlayIcon(false);
          } else {
            wavesurfer.play();
            togglePlayIcon(true);
          }
        };
      }

      function togglePlayIcon(isPlaying) {
        const p = document.getElementById('play-icon');
        const ps = document.getElementById('pause-icon');
        if (isPlaying) {
          p.style.display = 'none';
          ps.style.display = 'block';
        } else {
          p.style.display = 'block';
          ps.style.display = 'none';
        }
      }

      if (analyzeBtn) {
        analyzeBtn.onclick = async () => {
          if (isAnalyzing) return;
          isAnalyzing = true;
          // show loader
          analyzeLoader.classList.remove('hidden');
          analyzeBtn.setAttribute('disabled', 'disabled');
          analyzeBtn.classList.add('opacity-60', 'cursor-not-allowed');

          // simulate 4s processing
          await new Promise(r => setTimeout(r, 4000));

          // hide loader & show transcript
          analyzeLoader.classList.add('hidden');
          const item = data[currentTab][currentLang];
          transcriptDiv.textContent = item.transcript;
          transcriptDiv.classList.remove('hidden');

          analyzeBtn.removeAttribute('disabled');
          analyzeBtn.classList.remove('opacity-60', 'cursor-not-allowed');
          isAnalyzing = false;
        };
      }
    }

    /*********************************************************
     * Tabs: wire up top nav
     *********************************************************/
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
        btn.classList.add('tab-active');
        currentTab = btn.dataset.tab;
        renderBox();
      });
    });

    /*********************************************************
     * Language dropup interactions
     *********************************************************/
    const langToggle = document.getElementById('lang-toggle');
    const langMenu = document.getElementById('lang-menu');
    const langLabel = document.getElementById('lang-label');
    const langEmoji = document.getElementById('lang-emoji');

    langToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      langMenu.classList.toggle('hidden');
    });

    document.addEventListener('click', () => {
      langMenu.classList.add('hidden');
    });

    document.querySelectorAll('.lang-option').forEach(opt => {
      opt.addEventListener('click', (e) => {
        e.stopPropagation();
        const lang = opt.dataset.lang;
        currentLang = lang;
        // update label
        if (lang === 'english') {
          langLabel.textContent = 'English';
          langEmoji.textContent = 'üåê';
        } else {
          langLabel.textContent = '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç';
          langEmoji.textContent = 'üåê';
        }
        langMenu.classList.add('hidden');
        // render the content in the selected language
        renderBox();
      });
    });

    /*********************************************************
     * Init first render
     *********************************************************/
    renderBox();

    /*********************************************************
     * Make primary color easily modifiable via JS (optional)
     * If you ever want to change primary color dynamically, you
     * can set document.documentElement.style.setProperty('--primary-color', '#...').
     *********************************************************/
  </script>
</body>
</html>
